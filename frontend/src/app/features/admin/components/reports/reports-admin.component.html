<div class="admin-container">
  <div class="header">
    <h1>ğŸ“Š Napi ZÃ¡rÃ¡s</h1>
    <button (click)="goBack()" class="btn-back">â† Vissza a dashboardra</button>
  </div>

  <div class="date-selector">
    <label for="reportDate">DÃ¡tum:</label>
    <input 
      type="date" 
      id="reportDate" 
      [(ngModel)]="selectedDate" 
      (change)="loadReport()"
      class="date-input"
    />
    <button (click)="loadReport()" class="btn-refresh">ğŸ”„ FrissÃ­tÃ©s</button>
    <button (click)="exportPDF()" class="btn-export" *ngIf="!loading && !error && summary">ğŸ“„ PDF exportÃ¡lÃ¡s</button>
  </div>

  <div *ngIf="loading" class="loading">
    Riport betÃ¶ltÃ©se...
  </div>

  <div *ngIf="error" class="error-message">
    {{ error }}
  </div>

  <div *ngIf="!loading && !error && summary" class="report-content">
    <!-- Ã–sszesÃ­tÃ©s -->
    <div class="summary-cards">
      <div class="summary-card">
        <div class="card-icon">ğŸ«</div>
        <div class="card-value">{{ summary.total_reservations }}</div>
        <div class="card-label">FoglalÃ¡sok</div>
      </div>
      <div class="summary-card">
        <div class="card-icon">ğŸª‘</div>
        <div class="card-value">{{ summary.total_tickets }}</div>
        <div class="card-label">Jegyek</div>
      </div>
      <div class="summary-card highlight">
        <div class="card-icon">ğŸ’°</div>
        <div class="card-value">{{ summary.total_amount | number:'1.0-0' }} Ft</div>
        <div class="card-label">BevÃ©tel</div>
      </div>
    </div>

    <!-- AdminisztrÃ¡torÃ³nkÃ©nti bontÃ¡s -->
    <div class="report-section" *ngIf="summary.by_admin?.length">
      <h2>ğŸ‘¨â€ğŸ’¼ AdminisztrÃ¡torÃ³nkÃ©nti bontÃ¡s</h2>
      <table class="report-table">
        <thead>
          <tr>
            <th>AdminisztrÃ¡tor neve</th>
            <th>Email</th>
            <th>FoglalÃ¡sok</th>
            <th>Jegyek</th>
            <th>BevÃ©tel</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let item of summary.by_admin">
            <td>{{ item.admin_name }}</td>
            <td>{{ item.admin_email }}</td>
            <td>{{ item.reservations_count }}</td>
            <td>{{ item.tickets_count }}</td>
            <td class="amount">{{ item.total_amount | number:'1.0-0' }} Ft</td>
          </tr>
        </tbody>
        <tfoot>
          <tr class="total-row">
            <td colspan="2"><strong>Ã–SSZESEN</strong></td>
            <td><strong>{{ summary.total_reservations }}</strong></td>
            <td><strong>{{ summary.total_tickets }}</strong></td>
            <td class="amount"><strong>{{ summary.total_amount | number:'1.0-0' }} Ft</strong></td>
          </tr>
        </tfoot>
      </table>
    </div>

    <!-- ElÅ‘adÃ¡sok szerinti bevÃ©tel -->
    <div class="report-section" *ngIf="summary.by_showtime?.length">
      <h2>ğŸŸï¸ ElÅ‘adÃ¡sok szerinti bevÃ©tel</h2>
      <table class="report-table">
        <thead>
          <tr>
            <th>Film</th>
            <th>ElÅ‘adÃ¡s idÅ‘pont</th>
            <th>Terem</th>
            <th>FoglalÃ¡sok</th>
            <th>Jegyek</th>
            <th>BevÃ©tel</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let item of summary.by_showtime">
            <td>{{ item.movie_title }}</td>
            <td>{{ item.starts_at | date:'yyyy-MM-dd HH:mm' }}</td>
            <td>{{ item.auditorium_name }}</td>
            <td>{{ item.reservations_count }}</td>
            <td>{{ item.tickets_count }}</td>
            <td class="amount">{{ item.total_amount | number:'1.0-0' }} Ft</td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- FizetÃ©si mÃ³dok -->
    <div class="report-section" *ngIf="summary.by_payment_method?.length">
      <h2>ğŸ’³ FizetÃ©si mÃ³dok</h2>
      <table class="report-table">
        <thead>
          <tr>
            <th>FizetÃ©si mÃ³d</th>
            <th>TranzakciÃ³k</th>
            <th>Ã–sszeg</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let item of summary.by_payment_method">
            <td>
              <span *ngIf="item.method === 'cash'">ğŸ’µ KÃ©szpÃ©nz</span>
              <span *ngIf="item.method === 'card'">ğŸ’³ KÃ¡rtya</span>
              <span *ngIf="item.method !== 'cash' && item.method !== 'card'">{{ item.method }}</span>
            </td>
            <td>{{ item.count }}</td>
            <td class="amount">{{ item.amount | number:'1.0-0' }} Ft</td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- Ã“rÃ¡nkÃ©nti bontÃ¡s -->
    <div class="report-section" *ngIf="summary.hourly?.length">
      <h2>â° Ã“rÃ¡nkÃ©nti forgalom</h2>
      <div class="hourly-chart">
        <div *ngFor="let item of summary.hourly" class="hourly-bar">
          <div class="bar-label">{{ item.hour }}:00</div>
          <div class="bar-container">
            <div 
              class="bar-fill" 
              [style.width]="(item.amount / summary.total_amount * 100) + '%'"
            ></div>
          </div>
          <div class="bar-value">{{ item.count }} db / {{ item.amount | number:'1.0-0' }} Ft</div>
        </div>
      </div>
    </div>

    <!-- RÃ©szletes lista -->
    <div class="report-section" *ngIf="reservations?.length">
      <h2>ğŸ“‹ RÃ©szletes lista</h2>
      <table class="report-table">
        <thead>
          <tr>
            <th>ID</th>
            <th>IdÅ‘pont</th>
            <th>Film</th>
            <th>ÃœgyfÃ©l</th>
            <th>Jegyek</th>
            <th>Ã–sszeg</th>
            <th>FizetÃ©s</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let reservation of reservations">
            <td>#{{ reservation.id }}</td>
            <td>{{ reservation.created_at | date:'HH:mm' }}</td>
            <td>{{ reservation.showtime?.movie?.title || 'N/A' }}</td>
            <td>{{ reservation.customer_name || 'N/A' }}</td>
            <td>{{ reservation.items?.length || 0 }}</td>
            <td class="amount">{{ reservation.total_amount | number:'1.0-0' }} Ft</td>
            <td>
              <span *ngIf="reservation.payment_provider === 'cash'" class="payment-badge cash">ğŸ’µ KP</span>
              <span *ngIf="reservation.payment_provider === 'card'" class="payment-badge card">ğŸ’³ KÃ¡rtya</span>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- Nincs adat -->
    <div *ngIf="!reservations?.length" class="empty-state">
      ğŸ“­ Ezen a napon nem tÃ¶rtÃ©nt foglalÃ¡s.
    </div>
  </div>
</div>
