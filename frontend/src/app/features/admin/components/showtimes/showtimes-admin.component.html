<div class="admin-container">
  <div class="header">
    <h1>üé¨ El≈ëad√°sok kezel√©se</h1>
    <div class="header-actions">
      <button (click)="createNewShowtime()" class="btn-create">+ √öj el≈ëad√°s</button>
      <button (click)="goBack()" class="btn-back">‚Üê Vissza</button>
    </div>
  </div>

  <div class="toolbar" *ngIf="!loading && !error">
    <div class="toolbar-group">
      <label class="toolbar-label" for="showtime-search">Keres√©s</label>
      <input
        id="showtime-search"
        type="text"
        [(ngModel)]="searchTerm"
        placeholder="Film, terem, d√°tum vagy ID"
        class="toolbar-input" />
    </div>

    <div class="toolbar-group">
      <label class="toolbar-label" for="status-filter">St√°tusz</label>
      <select id="status-filter" [(ngModel)]="statusFilter" class="toolbar-select">
        <option value="all">√ñsszes</option>
        <option value="active">Akt√≠v</option>
        <option value="inactive">Inakt√≠v</option>
      </select>
    </div>

    <div class="toolbar-group">
      <label class="toolbar-label" for="sort-select">Rendez√©s</label>
      <select id="sort-select" [(ngModel)]="sortOption" class="toolbar-select">
        <option value="created_desc">Legfrissebb felvett el√∂l</option>
        <option value="created_asc">Legr√©gebbi felvett el√∂l</option>
        <option value="starts_asc">Kezd√©s n√∂vekv≈ë</option>
        <option value="starts_desc">Kezd√©s cs√∂kken≈ë</option>
        <option value="movie_asc">Film A ‚Üí Z</option>
        <option value="movie_desc">Film Z ‚Üí A</option>
        <option value="auditorium_asc">Terem A ‚Üí Z</option>
        <option value="auditorium_desc">Terem Z ‚Üí A</option>
      </select>
    </div>
  </div>

  <div *ngIf="loading" class="loading">
    El≈ëad√°sok bet√∂lt√©se...
  </div>

  <div *ngIf="error" class="error-message">
    {{ error }}
  </div>

  <div *ngIf="!loading && !error && filteredShowtimes.length === 0" class="empty-state">
    M√©g nincsenek el≈ëad√°sok
  </div>

  <table *ngIf="!loading && !error && filteredShowtimes.length > 0" class="showtimes-table">
    <thead>
      <tr>
        <th>ID</th>
        <th>Film</th>
        <th>Terem</th>
        <th>Kezd√©s</th>
        <th>St√°tusz</th>
        <th>M≈±veletek</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let showtime of filteredShowtimes">
        <td>{{ showtime.id }}</td>
        <td>{{ showtime.movie?.title || 'N/A' }}</td>
        <td>{{ showtime.auditorium?.name || 'N/A' }}</td>
        <td>{{ showtime.starts_at | date:'yyyy-MM-dd HH:mm' }}</td>
        <td>
          <span class="status-badge" [class.status-active]="showtime.status === 'active'">
            {{ showtime.status }}
          </span>
        </td>
        <td class="actions">
          <button class="btn-edit" (click)="editShowtime(showtime)">‚úèÔ∏è Szerkeszt√©s</button>
          <button class="btn-delete" (click)="deleteShowtime(showtime)">üóëÔ∏è T√∂rl√©s</button>
        </td>
      </tr>
    </tbody>
  </table>

  <!-- Edit Modal -->
  <div class="modal-overlay" *ngIf="showEditModal" (click)="closeModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>{{ isNewShowtime ? '‚ûï √öj el≈ëad√°s' : '‚úèÔ∏è El≈ëad√°s szerkeszt√©se' }}</h2>
        <button class="btn-close" (click)="closeModal()">‚úï</button>
      </div>
      
      <form *ngIf="editingShowtime" (ngSubmit)="saveShowtime()" class="edit-form">
        <div class="form-group">
          <label>Film</label>
          <div class="autocomplete-wrapper">
            <input 
              type="text" 
              [(ngModel)]="movieSearchTerm" 
              name="movieSearch"
              (focus)="onMovieSearchFocus()"
              (blur)="onMovieSearchBlur()"
              placeholder="Kezdj el g√©pelni..."
              class="form-input"
              autocomplete="off"
              required>
            <div class="autocomplete-dropdown" *ngIf="showMovieDropdown && filteredMovies.length > 0">
              <div 
                *ngFor="let movie of filteredMovies" 
                class="autocomplete-item"
                (click)="selectMovie(movie)">
                {{ movie.title }}
              </div>
            </div>
            <div class="autocomplete-dropdown" *ngIf="showMovieDropdown && movieSearchTerm && filteredMovies.length === 0">
              <div class="autocomplete-item no-results">Nincs tal√°lat</div>
            </div>
          </div>
        </div>

        <div class="form-group">
          <label>Terem</label>
          <div class="autocomplete-wrapper">
            <input 
              type="text" 
              [(ngModel)]="auditoriumSearchTerm" 
              name="auditoriumSearch"
              (focus)="onAuditoriumSearchFocus()"
              (blur)="onAuditoriumSearchBlur()"
              placeholder="Kezdj el g√©pelni..."
              class="form-input"
              autocomplete="off"
              required>
            <div class="autocomplete-dropdown" *ngIf="showAuditoriumDropdown && filteredAuditoria.length > 0">
              <div 
                *ngFor="let auditorium of filteredAuditoria" 
                class="autocomplete-item"
                (click)="selectAuditorium(auditorium)">
                {{ auditorium.name }}
              </div>
            </div>
            <div class="autocomplete-dropdown" *ngIf="showAuditoriumDropdown && auditoriumSearchTerm && filteredAuditoria.length === 0">
              <div class="autocomplete-item no-results">Nincs tal√°lat</div>
            </div>
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label>D√°tum</label>
            <input 
              type="date" 
              [(ngModel)]="dateString" 
              name="dateString" 
              class="form-input" 
              required>
          </div>

          <div class="form-group">
            <label>Id≈ëpont (24 √≥r√°s)</label>
            <input 
              type="time" 
              [(ngModel)]="timeString" 
              name="timeString" 
              class="form-input" 
              required>
          </div>
        </div>

        <div class="form-group">
          <label>St√°tusz</label>
          <select [(ngModel)]="editingShowtime.status" name="status" class="form-select" required>
            <option value="active">Akt√≠v</option>
            <option value="inactive">Inakt√≠v</option>
          </select>
        </div>

        <div class="modal-actions">
          <button type="button" (click)="closeModal()" class="btn-cancel">M√©gse</button>
          <button type="submit" class="btn-save">{{ isNewShowtime ? 'L√©trehoz√°s' : 'Ment√©s' }}</button>
        </div>
      </form>
    </div>
  </div>
</div>
