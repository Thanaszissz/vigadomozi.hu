<div class="page">
  <header class="topbar">
    <div class="brand">
      <img class="brand-logo" src="assets/vigado_logo_beige.png" alt="Vigad√≥ Mozi" />
    </div>
    <div class="header-right">
      <div class="search">
        <input type="text" placeholder="keresd meg. n√©zd meg. m≈±sor keres√©se" />
        <button class="search-btn">üîç</button>
      </div>
      <nav class="nav-links">
        <a routerLink="/">M≈±sor</a>
        <a routerLink="/schedule">M≈±sorlista</a>
        <a routerLink="/movies" class="active">Jegyv√°s√°rl√°s</a>
        <a routerLink="/prices">Jegy√°rak</a>
        <a routerLink="/">M√©diaaj√°nlat</a>
        <a routerLink="/admin/login" class="admin-link">üîê Admin</a>
      </nav>
    </div>
  </header>

  <section class="content">
    <div *ngIf="loading" class="state loading">
      <p>Adatok bet√∂lt√©se...</p>
    </div>

    <div *ngIf="error" class="state error">
      <p>{{ error }}</p>
    </div>

    <div *ngIf="!loading && showtime" class="seat-select-container">
      <div class="header">
        <h1>Sz√©k kiv√°laszt√°s</h1>
        <p>{{ showtime.movie.title }} - {{ showtime.starts_at | date: 'yyyy.MM.dd. HH:mm' }}</p>
        <p class="auditorium">{{ showtime.auditorium.name }}</p>
      </div>

      <div class="content-grid">
        <div class="seat-map-section">
          <div class="screen">{{ showtime.seatMap.layout.screenLabel || 'V√ÅSZON' }}</div>

          <div class="section-group" *ngFor="let group of getSectionGroups()">
            <div class="section-title">{{ group.name }}</div>
            <div class="seats-container">
              <div *ngFor="let rowLabel of group.rows" class="seat-row">
                <div class="row-label">{{ rowLabel }}</div>
                <div class="seats-line">
                  <div
                    *ngFor="let seat of getSeatsInRow(rowLabel)"
                    class="seat"
                    [ngClass]="getSeatClasses(seat)"
                    (click)="toggleSeat(seat)"
                    [title]="getSeatTitle(seat)">
                    <span *ngIf="!isAisle(seat)" class="seat-number">{{ seat.key.split('-')[1] }}</span>
                    <span *ngIf="isAisle(seat)" class="aisle-marker">||</span>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="legend">
            <div class="legend-item">
              <div class="legend-square available"></div>
              <span>Szabad</span>
            </div>
            <div class="legend-item">
              <div class="legend-square booked"></div>
              <span>Foglalt</span>
            </div>
            <div class="legend-item">
              <div class="legend-square locked"></div>
              <span>Lefoglalva</span>
            </div>
            <div class="legend-item">
              <div class="legend-square selected"></div>
              <span>Kiv√°lasztott</span>
            </div>
          </div>
        </div>

        <div class="summary-section">
          <div class="summary-card">
            <h2>Foglal√°s √∂sszegz√©se</h2>

            <div *ngIf="selectedSeats.length === 0" class="no-seats">
              <p>M√©g nincsenek kiv√°lasztott sz√©kek.</p>
            </div>

            <div *ngIf="selectedSeats.length > 0" class="selected-seats-list">
              <div *ngFor="let seat of selectedSeats" class="seat-item">
                <span>{{ seat.key }} - {{ seat.price }} Ft</span>
              </div>

              <div class="total">
                <strong>√ñsszesen:</strong>
                <strong class="price">{{ totalPrice }} Ft</strong>
              </div>
            </div>

            <div class="email-input">
              <label for="name">N√©v:</label>
              <input
                id="name"
                type="text"
                [(ngModel)]="name"
                placeholder="Teljes n√©v"
                class="form-control">
            </div>

            <div class="email-input">
              <label for="phone">Telefonsz√°m:</label>
              <input
                id="phone"
                type="tel"
                [(ngModel)]="phone"
                placeholder="+36 30 123 4567"
                class="form-control">
            </div>

            <div class="email-input">
              <label for="email">Email c√≠m:</label>
              <input
                id="email"
                type="email"
                [(ngModel)]="email"
                placeholder="jegyek@example.com"
                class="form-control">
            </div>

            <button
              (click)="reserve()"
              [disabled]="selectedSeats.length === 0 || !email || !name || !phone || isProcessing"
              class="btn btn-primary">
              <span *ngIf="!isProcessing">Kifizetem k√°rty√°val (10 perc)</span>
              <span *ngIf="isProcessing">Feldolgoz√°s...</span>
            </button>

            <button
              (click)="hold()"
              [disabled]="selectedSeats.length === 0 || !email || !name || !phone || isProcessing"
              class="btn btn-hold">
              <span *ngIf="!isProcessing">Lefoglalva</span>
              <span *ngIf="isProcessing">Feldolgoz√°s...</span>
            </button>

            <div *ngIf="lockError" class="error-message">{{ lockError }}</div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <footer class="footer">
    <div class="footer-col">
      <h4>Inform√°ci√≥k</h4>
      <a href="#">H√°zirend</a>
      <a href="#">Fizet√©si t√°j√©koztat√≥</a>
      <a href="#">Adatkezel√©si t√°j√©koztat√≥</a>
    </div>
    <div class="footer-col">
      <h4>Kapcsolat</h4>
      <p>Vigad√≥ Mozi ‚Ä¢ Film √©s Sz√≠nh√°z</p>
      <p>5310 Kis√∫jsz√°ll√°s Szabads√°g T√©r 7.</p>
      <p>+36-59-328-083</p>
      <p>info&#64;vigadomozi.hu</p>
    </div>
    <div class="footer-col">
      <h4>Impresszum</h4>
      <p>Kis√∫jsz√°ll√°si M≈±vel≈ëd√©si K√∂zpont √©s K√∂nyvt√°r</p>
    </div>
  </footer>
</div>
